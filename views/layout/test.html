<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Masuk & Daftar | Dabelyuland Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#0052CC",
              "primary-dark": "#0747A6",
            },
            fontFamily: {
              sans: ["Plus Jakarta Sans", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      .glass-effect {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .fade-in {
        animation: fadeIn 0.3s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Mencegah teks mentah muncul sebelum icon font dimuat */
      .material-symbols-outlined {
        font-display: block;
        overflow: hidden;
        width: 24px;
        height: 24px;
        color: transparent;
        text-indent: -9999px;
        display: inline-block;
        vertical-align: middle;
      }

      .material-symbols-outlined::before {
        text-indent: 0;
        float: left;
        color: inherit;
        content: attr(data-icon); /* Gunakan attribute untuk memanggil icon */
      }
    </style>
  </head>
  <body class="bg-gray-50 font-sans text-slate-900 overflow-hidden">
    <main class="flex-grow w-full max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <!-- foto -->
      <section class="mb-8 relative group rounded-2xl overflow-hidden shadow-sm">
        <div class="grid grid-cols-1 md:grid-cols-4 grid-rows-2 gap-2 h-[400px] md:h-[520px]">
          <div onclick="openLightbox(0)" class="col-span-1 md:col-span-2 row-span-2 relative overflow-hidden cursor-pointer">
            <div class="w-full h-full bg-gray-200 bg-cover bg-center transition-transform duration-700 hover:scale-105" style="background-image: url(<?=$property[&quot;images&quot;][0][&quot;image_url&quot;]?>)"></div>
          </div>
          <div onclick="openLightbox(1)" class="hidden md:block col-span-1 row-span-1 relative overflow-hidden cursor-pointer">
            <div class="w-full h-full bg-gray-200 bg-cover bg-center transition-transform duration-700 hover:scale-105" style="background-image: url(<?=$property[&quot;images&quot;][1][&quot;image_url&quot;]?>)"></div>
          </div>

          <div onclick="openLightbox(2)" class="hidden md:block col-span-1 row-span-1 relative overflow-hidden cursor-pointer">
            <div class="w-full h-full bg-gray-200 bg-cover bg-center transition-transform duration-700 hover:scale-105" style="background-image: url(<?=$property[&quot;images&quot;][2][&quot;image_url&quot;]?>)"></div>
          </div>

          <div onclick="openLightbox(3)" class="hidden md:block col-span-1 row-span-1 relative overflow-hidden cursor-pointer">
            <div class="w-full h-full bg-gray-200 bg-cover bg-center transition-transform duration-700 hover:scale-105" style="background-image: url(<?=$property[&quot;images&quot;][3][&quot;image_url&quot;]?>)"></div>
          </div>

          <div onclick="openLightbox(4)" class="hidden md:block col-span-1 row-span-1 relative overflow-hidden cursor-pointer">
            <div class="w-full h-full bg-gray-200 bg-cover bg-center transition-transform duration-700 hover:scale-105" style="background-image: url(<?=$property[&quot;images&quot;][4][&quot;image_url&quot;]?>)"></div>

            <button
              onclick="
                event.stopPropagation();
                openLightbox(0);
              "
              class="absolute bottom-4 right-4 bg-white dark:bg-black/80 hover:bg-gray-100 dark:hover:bg-black text-[#0d121b] dark:text-white text-sm font-semibold py-2 px-4 rounded-lg shadow-lg flex items-center gap-2 transition-all"
            >
              <span class="material-symbols-outlined text-[18px]">grid_view</span>
              Lihat semua foto
            </button>
          </div>
        </div>
      </section>
      <!-- end foto -->

      <!-- pop up lihat foto -->
      <div id="photoLightbox" class="lightbox-overlay">
        <button class="close-lightbox" onclick="closeLightbox()">&times;</button>

        <div class="lightbox-content">
          <button class="nav-btn prev" onclick="changePhoto(-1)">&#10094;</button>

          <div class="main-photo-wrapper">
            <img id="activePhoto" src="" alt="Gallery Image" />
          </div>

          <button class="nav-btn next" onclick="changePhoto(1)">&#10095;</button>
        </div>
      </div>
      <!-- end pop up -->

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 relative">
        <div class="lg:col-span-8 flex flex-col gap-10">
          <div class="border-b border-gray-100 dark:border-gray-800 pb-8">
            <div class="flex flex-col gap-4">
              <div>
                <div class="flex items-center gap-2 mb-2"></div>
                <h1 class="text-[#0d121b] dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-[-0.03em] mb-2"><?= $property['title'] ?></h1>
                <p class="text-gray-500 dark:text-gray-400 text-lg font-normal flex items-center gap-2">
                  <span class="material-symbols-outlined text-[20px]">location_on</span>
                  <?= $property['district'] ?>, <?= $property['city'] ?>
                </p>
              </div>
              <div class="flex flex-wrap gap-4 mt-2">
                <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-surface-light dark:bg-surface-dark border border-gray-100 dark:border-gray-800">
                  <span class="material-symbols-outlined text-primary text-2xl">bed</span>
                  <div class="flex flex-col">
                    <span class="text-sm font-bold text-gray-900 dark:text-white"><?= $property['bedrooms'] ?></span>
                    <span class="text-xs text-gray-500 uppercase font-semibold tracking-wider">Kamar Tidur</span>
                  </div>
                </div>
                <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-surface-light dark:bg-surface-dark border border-gray-100 dark:border-gray-800">
                  <span class="material-symbols-outlined text-primary text-2xl">bathtub</span>
                  <div class="flex flex-col">
                    <span class="text-sm font-bold text-gray-900 dark:text-white"><?= $property['bathrooms'] ?></span>
                    <span class="text-xs text-gray-500 uppercase font-semibold tracking-wider">Kamar Mandi</span>
                  </div>
                </div>
                <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-surface-light dark:bg-surface-dark border border-gray-100 dark:border-gray-800">
                  <span class="material-symbols-outlined text-primary text-2xl">straighten</span>
                  <div class="flex flex-col">
                    <span class="text-sm font-bold text-gray-900 dark:text-white"><?= $property['building_area'] ?></span>
                    <span class="text-xs text-gray-500 uppercase font-semibold tracking-wider">MÂ²</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex items-center justify-between py-2">
            <div class="flex items-center gap-4"></div>
          </div>
          <div class="flex flex-col gap-4">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Tentang hunian ini</h2>

            <div id="descContainer" class="text-gray-600 dark:text-gray-300 leading-relaxed space-y-4 line-clamp-3 transition-all duration-300">
              <p><?= nl2br($property['description']) ?></p>
            </div>

            <button id="toggleBtn" onclick="toggleDescription()" class="self-start flex items-center gap-1 text-primary font-semibold text-sm mt-2 group">
              <span id="btnText">Tampilkan lebih banyak</span>
              <span id="btnIcon" class="material-symbols-outlined text-[18px] group-hover:translate-y-0.5 transition-transform">expand_more</span>
            </button>
          </div>
          <hr class="border-gray-100 dark:border-gray-800" />

          <!-- fasilitas -->
          <div class="flex flex-col gap-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Apa yang ditawarkan tempat ini</h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-4 gap-x-12" id="facilityContainer">
              <?php foreach($property['facilities'] as $index => $facility): ?>
              <div class="facility-item flex items-center gap-3 text-gray-700 dark:text-gray-300 <?= $index >= 6 ? 'hidden' : '' ?>">
                <span class="material-symbols-outlined text-slate-900 dark:text-slate-100 scale-75">radio_button_checked</span>
                <span><?= $facility['facility_label'] ?></span>
              </div>
              <?php endforeach; ?>
            </div>

            <?php if (count($property['facilities']) > 6): ?>
            <button onclick="toggleFacilities(this)" class="self-start mt-4 px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-700 font-semibold text-sm hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
              Tampilkan semua <?= count($property['facilities']) ?> fasilitas
            </button>
            <?php endif; ?>
          </div>
          <!-- fasilitas end -->

          <hr class="border-gray-100 dark:border-gray-800" />
          <div class="flex flex-col gap-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Lokasi Properti</h2>

            <!-- maps -->
            <div class="w-full h-80 rounded-xl bg-gray-200 overflow-hidden relative group shadow-inner border border-gray-100">
              <iframe
                class="w-full h-full border-0 grayscale-[10%] contrast-[1.1]"
                src="https://maps.google.com/maps?q=<?= $property['latitude'] ?>,<?= $property['longitude'] ?>&output=embed"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
              >
              </iframe>

              <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
                <div class="relative flex items-center justify-center">
                  <div class="absolute size-12 rounded-full bg-blue-600/20 animate-pulse"></div>
                  <div class="relative size-4 bg-blue-600 rounded-full border-2 border-white shadow-xl"></div>
                </div>
              </div>
            </div>
            <!-- maps -->
          </div>
        </div>
        <div class="lg:col-span-4 relative">
          <div class="sticky top-28 w-full">
            <div class="bg-white dark:bg-surface-dark rounded-2xl border border-gray-200 dark:border-gray-800 shadow-xl p-6 flex flex-col gap-6">
              <div class="flex justify-between items-end">
                <div class="flex items-baseline gap-1">
                  <span class="text-2xl font-bold text-gray-900 dark:text-white">Rp <?= number_format($property['price'], 0, '.', '.') ?></span>
                  <span class="text-gray-500 text-sm"></span>
                </div>
                <div class="flex items-center gap-1 text-sm text-gray-500"></div>
              </div>
              <div class="flex flex-col rounded-lg border border-gray-300 dark:border-gray-700 overflow-hidden">
                <div class="flex border-b border-gray-300 dark:border-gray-700">
                  <span class="material-symbols-outlined text-gray-400"></span>
                </div>
              </div>
              <button class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3.5 rounded-lg shadow-lg shadow-primary/30 transition-all active:scale-[0.98]">Ajukan Pemesanan</button>
            </div>
            <div class="mt-6 flex justify-center">
              <a class="flex items-center gap-2 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition-colors text-sm font-medium" href="#"> </a>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      function toggleFacilities(btn) {
        const items = document.querySelectorAll(".facility-item");
        const isExpanding = btn.innerText.includes("Tampilkan semua");

        items.forEach((item, index) => {
          if (index >= 6) {
            item.classList.toggle("hidden");
          }
        });

        if (isExpanding) {
          btn.innerText = "Sembunyikan fasilitas";
        } else {
          btn.innerText = `Tampilkan semua ${items.length} fasilitas`;
        }
      }
      function toggleDescription() {
        const container = document.getElementById("descContainer");
        const btnText = document.getElementById("btnText");
        const btnIcon = document.getElementById("btnIcon");

        // Cek apakah sedang di-clamp (dipotong)
        if (container.classList.contains("line-clamp-3")) {
          // Buka deskripsi
          container.classList.remove("line-clamp-3");
          btnText.textContent = "Tampilkan lebih sedikit";
          btnIcon.innerText = "expand_less"; // Ubah icon panah ke atas
        } else {
          // Tutup deskripsi
          container.classList.add("line-clamp-3");
          btnText.textContent = "Tampilkan lebih banyak";
          btnIcon.innerText = "expand_more"; // Ubah icon panah ke bawah
        }
      }
      document.addEventListener("DOMContentLoaded", () => {
        // 1. Staggered Reveal (Muncul satu per satu dengan delay)
        const cards = document.querySelectorAll(".lg\\:col-span-8 > div, .grid.grid-cols-1.sm\\:grid-cols-2 > div");

        const revealObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry, index) => {
              if (entry.isIntersecting) {
                setTimeout(() => {
                  entry.target.style.opacity = "1";
                  entry.target.style.transform = "translateY(0)";
                }, index * 50); // Delay bertahap 50ms per elemen
                revealObserver.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.1 },
        );

        cards.forEach((card) => {
          card.style.opacity = "0";
          card.style.transform = "translateY(15px)";
          card.style.transition = "opacity 0.8s cubic-bezier(0.2, 0.8, 0.2, 1), transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1)";
          revealObserver.observe(card);
        });

        // 2. Airbnb "Lift & Glow" Effect pada Gambar Galeri
        const images = document.querySelectorAll('.group.rounded-2xl div[style*="background-image"]');
        images.forEach((img) => {
          const parent = img.parentElement;
          parent.style.transition = "transform 0.45s cubic-bezier(0.2, 1, 0.2, 1)";

          parent.addEventListener("mouseenter", () => {
            parent.style.transform = "scale(0.98)"; // Sedikit mengecil saat hover (press effect)
            img.style.filter = "brightness(0.9)";
          });

          parent.addEventListener("mouseleave", () => {
            parent.style.transform = "scale(1)";
            img.style.filter = "brightness(1)";
          });
        });

        // 3. Sticky Sidebar Bounce (Interaksi Halus pada Card Harga)
        const stickyCard = document.querySelector(".lg\\:col-span-4 .sticky > div");
        if (stickyCard) {
          window.addEventListener(
            "scroll",
            () => {
              const scrollPos = window.scrollY;
              // Memberikan efek floating halus saat scroll
              stickyCard.style.transform = `translateY(${Math.sin(scrollPos / 100) * 2}px)`;
            },
            { passive: true },
          );
        }

        // 4. Ripple Effect pada Tombol Utama (Ajukan Pemesanan)
        const ctaBtn = document.querySelector("button.bg-primary");
        ctaBtn.addEventListener("click", function (e) {
          let x = e.clientX - e.target.offsetLeft;
          let y = e.clientY - e.target.offsetTop;

          let ripple = document.createElement("span");
          ripple.style.left = x + "px";
          ripple.style.top = y + "px";
          ripple.classList.add("ripple");
          this.appendChild(ripple);

          setTimeout(() => {
            ripple.remove();
          }, 600);
        });

        // Tambahkan style ripple via JS agar tidak mengubah file CSS
        const style = document.createElement("style");
        style.innerHTML = `
          button.bg-primary { position: relative; overflow: hidden; }
          .ripple {
              position: absolute;
              background: rgba(255, 255, 255, 0.3);
              transform: translate(-50%, -50%);
              pointer-events: none;
              border-radius: 50%;
              animation: ripple-animation 0.6s linear;
          }
          @keyframes ripple-animation {
              from { width: 0px; height: 0px; opacity: 0.5; }
              to { width: 500px; height: 500px; opacity: 0; }
          }
      `;
        document.head.appendChild(style);

        // 5. Active State on Amenities (Hover yang lebih taktil)
        const amenityItems = document.querySelectorAll(".flex.items-center.gap-3.text-gray-700");
        amenityItems.forEach((item) => {
          item.style.transition = "all 0.2s ease";
          item.classList.add("cursor-default", "p-2", "-ml-2", "rounded-lg");

          item.addEventListener("mouseenter", () => {
            item.style.backgroundColor = "rgba(19, 91, 236, 0.05)";
            item.style.transform = "translateX(5px)";
            item.querySelector("span").style.color = "#135bec";
          });

          item.addEventListener("mouseleave", () => {
            item.style.backgroundColor = "transparent";
            item.style.transform = "translateX(0)";
            item.querySelector("span").style.color = "";
          });
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        const readMoreBtn = document.querySelector("button.self-start.flex.items-center.gap-1.text-primary");
        const descriptionText = document.querySelector(".text-gray-600.dark:text-gray-300.leading-relaxed.space-y-4 p:last-child");

        if (readMoreBtn && descriptionText) {
          let isOpen = false;

          // Berikan transisi pada container teks
          descriptionText.style.transition = "all 0.5s cubic-bezier(0.4, 0, 0.2, 1)";

          readMoreBtn.addEventListener("click", () => {
            isOpen = !isOpen;

            if (isOpen) {
              // Keadaan Terbuka
              descriptionText.classList.remove("line-clamp-3");
              readMoreBtn.innerHTML = `
                      Tampilkan lebih sedikit
                      <span class="material-symbols-outlined text-[18px] transition-transform duration-300 rotate-180">expand_more</span>
                  `;
              // Efek fade in saat teks terbuka
              descriptionText.style.opacity = "0";
              setTimeout(() => {
                descriptionText.style.opacity = "1";
              }, 10);
            } else {
              // Keadaan Tertutup
              descriptionText.classList.add("line-clamp-3");
              readMoreBtn.innerHTML = `
                      Tampilkan lebih banyak
                      <span class="material-symbols-outlined text-[18px] transition-transform duration-300">expand_more</span>
                  `;

              // Scroll halus kembali ke area deskripsi agar user tidak bingung
              descriptionText.scrollIntoView({ behavior: "smooth", block: "nearest" });
            }
          });
        }
      });

      // Mengambil semua URL gambar dari grid
      const images = ["", ""];
      console.log("images: ", images);

      let currentIndex = 0;

      // Modifikasi: Sekarang menerima parameter 'index'
      function openLightbox(index = 0) {
        currentIndex = index; // Set foto sesuai yang diklik
        updateLightboxImage();
        document.getElementById("photoLightbox").style.display = "flex";
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        document.getElementById("photoLightbox").style.display = "none";
        document.body.style.overflow = "auto";
      }

      function changePhoto(step) {
        currentIndex += step;
        if (currentIndex >= images.length) currentIndex = 0;
        if (currentIndex < 0) currentIndex = images.length - 1;
        updateLightboxImage();
      }

      function updateLightboxImage() {
        document.getElementById("activePhoto").src = images[currentIndex];
      }

      // Close jika klik area buram
      window.onclick = function (event) {
        const modal = document.getElementById("photoLightbox");
        if (event.target == modal) closeLightbox();
      };
    </script>
  </body>
</html>
